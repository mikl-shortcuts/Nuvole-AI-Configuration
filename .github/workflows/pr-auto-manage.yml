name: PR Auto Manage

on:
  pull_request:
    types: [opened, synchronize]

jobs:
  manage:
    if: github.event.pull_request.user.login == 'mikl-shortcuts' && startsWith(github.event.pull_request.title, 'Changes in')
    runs-on: ubuntu-latest

    steps:
      - name: Add Eyes Reaction
        uses: actions/github-script@v7
        with:
          script: |
            await github.rest.reactions.createForIssue({
              owner: context.repo.owner,
              repo: context.repo.repo,
              issue_number: context.payload.pull_request.number,
              content: 'eyes'
            })

      - name: Extract and Assign User
        uses: actions/github-script@v7
        with:
          script: |
            const body = context.payload.pull_request.body || ""
            const match = body.match(/@([a-zA-Z0-9_-]+)/)
            if (match) {
              const username = match[1]
              await github.rest.issues.addAssignees({
                owner: context.repo.owner,
                repo: context.repo.repo,
                issue_number: context.payload.pull_request.number,
                assignees: [username]
              })
            }